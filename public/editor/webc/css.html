
<link rel="import" href="/editor/webc/font-set.html">
<link rel="import" href="/editor/webc/img-set.html">
<p-element name="panel-css">


<template>
<style>

    .nav-tabs > li > a {
        border-radius: 0 !important;
        border: 0 !important;
        margin-right: 0px;
    }

    panel-css {

    }
    label{
        font-weight: normal;
    }

    a.focus {
        outline: none !important;
    }

    .accordion .content {
        padding: 10px 0;

    }

    .group {

        padding: 5px 10px;
        line-height: 25px;

    }

    .group .form-control {
        padding: 5px 5px !important;
    }

    .content .divider {
        border-top: solid 1px #ccc;
        margin: 10px 0px;
        height: 1px;

    }

    .group .inline {
        width: 50px;
        padding: 0 5px;
    }

    .group .text {

        width: 30%;
    }

    .group .c-1 {
        width: 70%;
    }

    .group .c-3 {
        width: 23%;
        padding: 5px;
    }

    .group .slide-c {

        width: 40%;
        margin-top: 10px;
    }

    .group .inline {
        float: left;

        overflow: visible;
    }

    .group .content {
        padding: 0;
    }

    .group .input {
        float: left;
        width: 20%;
    }

    .group input[type="text"] {

        width: 100%;
    }

    .group .text-input {
        text-align: center;

    }

    .group .text-input span {

    }

    .group .c-2 {
        width: 63px !important;
    }

    .group:before,
    .group:after {
        display: table;
        line-height: 0;
        content: "";
        clear: both;
    }

    .minicolors {
        height: 20px;
        width: 30px;
        background-color: #7745ff;
        border: solid 1px #000000;
    }

    .border-left, .border-top, .border-right, .border-bottom {
        display: inline-block;
        height: 16px;
        width: 20px;
        background-color: #ccc;
        margin-right: 10px;

    }

    .border-left {
        border-left: solid 5px #000;
    }

    .border-top {
        border-top: solid 5px #000;
    }

    .border-right {
        border-right: solid 5px #000;
    }

    .border-bottom {
        border-bottom: solid 5px #000;
    }

    .list-group-item > .badge {
        margin: 0;
    }

        /* v2.0*/

    .form-group {
        margin: 0 0px;
    }

    .input-num .slider {
        display: inline-block;
        width: 64%;
        margin-right: 3%;
    }

    .input-num input {
        display: inline-block;
        width: 30%;
    }

    .input-c2 > * {
        display: inline-block;
        width: 48%;
    }

    .input-vlabel {
        text-align: center;
    }

    .form-control {
        height: 25px;
        padding: 2px;
    }


</style>

<div class="collapse-panel">

    <font-set class="font-set"></font-set>
    <img-set class="img-set"></img-set>


    <h3 class="collapse-header" data-toggle="collapse" data-target="#layout-panel">
        布局
    </h3>

    <div class="collapse-body collapse in" id="layout-panel">
        <div class="collapse-body-panel">
            <div class="form-group border-radius">


                <label>圆角</label>

                <div class="input-num">
                    <div class="slider" data-cssname="borderRadius" data-value="0" data-step="1"
                         data-min="0"
                         data-max="40"></div>
                    <input class="form-control" data-cssname="borderRadius" value=0 type="number"/>

                </div>


            </div>
            <div class="divider"></div>
            <div class="form-group opcity ">

                <label>透明度</label>


                <div class="input-num">
                    <div class="slider" data-cssname="opacity" data-value="1" data-step="0.1" data-min="0"
                         data-max="1"></div>
                    <input class="form-control" data-cssname="opacity" type="number"/>

                </div>


            </div>
            <div class="divider"></div>
            <div class="form-group position ">

                <label>位置</label>

                <div class="input-c2">


                    <div class="input-vlabel">
                        <input class="form-control" data-cssunit="px"
                               data-cssname="marginLeft"
                               type="number"/>
                        <span>距左</span>
                    </div>
                    <div class="input-vlabel">
                        <input class="form-control" data-cssunit="px"
                               data-cssname="marginTop"
                               type="number"/>
                        <span>距上</span>
                    </div>


                </div>


            </div>
            <div class="form-group size">


                <label>大小</label>

                <div class="input-c2">


                    <div class="input-vlabel"><input class="form-control" type="number" data-cssunit="px"
                                                     data-cssname="width"/><span>宽度</span>
                    </div>
                    <div class="input-vlabel"><input class="form-control" type="number" data-cssunit="px"
                                                     data-cssname="height"/><span>高度</span>
                    </div>


                </div>


            </div>

        </div>

    </div>

    <h3 class="collapse-header" data-toggle="collapse" data-target="#border-panel">
        边框
    </h3>

    <div class="collapse-body collapse" id="border-panel">
        <div class="collapse-body-panel">
            <div class="group border-dir">

                <div class="border-left"></div>
                <div class="border-top"></div>
                <div class="border-right"></div>
                <div class="border-bottom"></div>


            </div>
            <div class="group border">


                <div class="text inline">
                    <select class="form-control" data-cssname="borderStyle">
                        <option value="solid" checked>solid</option>
                        <option value="dotted">dotted</option>
                        <option value="double">double</option>
                        <option value="groove">groove</option>
                        <option value="ridge">ridge</option>
                        <option value="inset">inset</option>
                        <option value="outset">outset</option>
                    </select></div>


                <div class='inline c-2'><input class="form-control" type="text" value="0"
                                               data-cssname="borderWidth"/>
                </div>
                <div class='inline c-2'>
                    <div class="minicolors" data-cssname="borderColor"></div>
                </div>

            </div>

        </div>
    </div>

    <h3 class="collapse-header" data-toggle="collapse" data-target="#bgg-panel">
        背景
    </h3>

    <div class="collapse-body collapse" id="bgg-panel">
        <div class="collapse-body-panel">
            <div class="item bgcolor">

                <div>
                    <a data-cssname="backgroundColor" class="btn btn-small minicolors" value="#7745ff"></a>
                    <a data-cssname="backgroundImage" class="btn btn-small">背景图</a>
                </div>


            </div>
        </div>
    </div>

    <!-- <h3 class="collapse-header" data-toggle="collapse" data-target="#action-panel">
         动作
     </h3>

     <div class="collapse-body" id="action-panel" class="collapse">
         <div class="collapse-body-panel">
             <ul class="list-group actions" style="margin: 10px">
                 <li class="list-group-item eventtype" data-eventtype="click">点击<span
                         class="badge start">+</span> <span
                         class="badge end">-</span></li>
                 <li class="list-group-item" data-eventtype="hover">悬停<span class="badge">+</span></li>

             </ul>
         </div>

     </div>
     -->
    <h3 class="collapse-header" data-toggle="collapse" data-target="#align-panel">
        对齐
    </h3>

    <div class="collapse-body collapse" id="align-panel">
        <div class="collapse-body-panel">
            <align style="height:80px;display: block"></align>
        </div>
    </div>


</div>

</template>

<script>

function actions() {
    $(".actions .start").click(function (el) {
        var target = $(el.target);
        var type = target.parent().attr("data-eventtype");
        play.action.start(type);


    })
    $(".actions .end").click(function (el) {

        play.action.end();


    })


}
var border = function () {
    var dirs = getValue('[data-css="border-dir"]');
    var width = getValue("[data-css='border-size']") + "px"
    var color = getValue("[data-css='border-color']")
    var style = getValue("[data-css='border-style']");

    if (dirs == "null")return "";
    if (dirs == "all")var borderWidth = width;
    if (dirs == "left")var borderWidth = 0 + " " + 0 + " " + 0 + " " + width;
    if (dirs == "right")var borderWidth = 0 + " " + width + " " + 0 + " " + 0;
    if (dirs == "top")var borderWidth = width + " " + 0 + " " + 0 + " " + 0;
    if (dirs == "bottom")var borderWidth = 0 + " " + 0 + " " + width + " " + 0;


    return {
        borderStyle: style,
        borderColor: color,
        borderWidth: borderWidth

    }
};

({
    readyCallback: function () {


        actions();

        var targetColorInput;

        $(".font-set").hide();
        $(".img-set").hide();





        var changeStep = play.utils.createStepRun(1000);
        $(".slider").each(function (index, el) {
            el = $(el);
            var min = parseFloat(el.attr("data-min"));
            var max = parseFloat(el.attr("data-max"));
            var step = parseFloat(el.attr("data-step"));
            var val = parseFloat(el.attr("data-value"));
            var cssname = $(this).attr("data-cssname")
            $(el).slider({
                heightStyle: "content",
                range: "min",
                value: val,
                step: step,
                min: min,
                max: max,


                slide: function (event, ui) {

                    var f = function () {
                        $('[data-cssname="' + cssname + '"]').val(ui.value);

                        var value = ui.value;
                        var unit = $('[data-cssname="' + cssname + '"]').attr("data-cssunit");
                        if (unit) {

                            value += unit;
                        }

                        $(document).trigger("csschange", [cssname, value, unit]);

                    }
                    changeStep.run(f)

                }
            });
            $('[data-cssname="' + cssname + '"]').val(val);

        })

        $(document).on("selectEl", function (ev, target) {
            // play.layout.open("east")


            if (target.prop("tagName").toLowerCase() == "p-layout") {

                $(".layout-panel").collapse("show");

            }


            if (target.prop("tagName").toLowerCase() == "p-text") {
                $(".font-set").show();
                $(".font-set").get(0).open();

            }
            else {
                $(".font-set").hide();

            }


            if (target.prop("tagName").toLowerCase() == "p-pic") {
                $(".img-set").show();
                $(".img-set").get(0).open();

            }
            else {
                $(".img-set").hide();

            }


            $('#tabs .style-set').tab('show')
            upgrade(target);


        })






        var host = this;


        $(".minicolors").click(function (ev) {

            targetColorInput = $(ev.target);



          $("colorpicker").get(0).pick(targetColorInput) ;

        })


        //选择文本


        //图片上传
        var ok = false;


        $('[data-cssname="backgroundImage"]', this).on("click", function () {

            play.selectImg.show();
            play.selectImg.onSelect = function (src) {
                if (!ok)return;
                var el = play.select.selectedEL;
                play.dom.css(el, "backgroundImage", "url('" + src + "')");
                ok = false;

            };

            ok = true;


            return;


        })



        /*数据同步*/
        $("input", this).on("keyup", function (e) {
            var target = $(e.target);
            var cssname = target.attr("data-cssname");
            var unit = target.attr("data-cssunit");
            var value = target.val();
            if (unit) {

                value += unit;
            }


            $(document).trigger("csschange", [cssname, value, unit]);

        })

        $("select", this).on("change", function (e) {
            var target = $(e.target);
            var cssname = target.attr("data-cssname");
            var unit = target.attr("data-cssunit");
            var value = target.val();
            if (unit) {

                value += unit;
            }


            $(document).trigger("csschange", [cssname, value, unit]);

        })

        $("button", this).on("click", function (e) {
            var target = $(e.target);
            var cssname = target.attr("data-cssname");
            var unit = target.attr("data-cssunit");
            var value = target.attr("value");
            if (unit) {

                value += unit;
            }

            if (cssname) {

                $(document).trigger("csschange", [cssname, value, unit]);
            }


        })

        $(document).on("csschange", function (e, cssname, value) {


            play.select.selectedEL && play.dom.css(play.select.selectedEL, cssname, value);

        })
        var cssNames = {
            "borderRadius": {},
            "opacity": {},
            "width": {unit: "px"},
            "height": {unit: "px"},
            "marginTop": {unit: "px"},
            "marginLeft": {unit: "px"},
            "backgroundColor": {},
            "borderWidth": {unit: "px"},
            "borderStyle": {},
            "borderColor": {},
            "fontSize": {unit: "px"},
            "fontFamily": {},
            "color": {}
        }

        function upgrade(el) {

            for (var p in cssNames) {
                var value = el.css(p);
                var cfg = cssNames[p];

                if (cfg.unit == "px") {
                    value = parseInt(value)
                }


                var target = $('[data-cssname="' + p + '"]')

                if (target.prop("tagName").toLowerCase() == "input") {

                    target.val(value);
                } else {
                    target.css(p, value)
                }


            }


        }


    }


});


</script>


</p-element>